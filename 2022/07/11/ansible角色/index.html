
<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>Ansible角色 | 欢迎浏览</title>
        <meta name="author" content="Eva">
        <meta name="description" content="">
        <meta name="keywords" content="">
        <link rel="icon" href="">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.1.1/js/all.min.js"></script>
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 6.2.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:200;justify-content:space-between;background:#fff;transition:opacity 0.3s ease-out"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">加载过慢请开启缓存(浏览器默认开启)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="show_page" style="display: -not-none">
                    <div id="menu_show">
                         
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">欢迎浏览</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;首页</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;关于</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;归档</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;标签</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div class="curtain" @click="menu_show = !menu_show" v-show="menu_show"></div>
        <div :class="'title'" @click="menu_show = !menu_show">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;欢迎浏览</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">首页</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">关于</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">归档</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">标签</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        
<div class="article">
    <div>
        <h1>Ansible角色 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/7/11
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
            </span>
            
            <span class="tag">
                
                <a href="/tags/ansible" style="color: #03a9f4">
                    ansible
                </a>
            </span>
            
        </span>
        
    </div>
    <div class="content" v-pre>
        <h1 id="ansible-角色"><a href="#ansible-角色" class="headerlink" title="ansible 角色"></a><strong>ansible 角色</strong></h1><hr>
<h5 id="基本语法创建一个-yaml-或-yml文件"><a href="#基本语法创建一个-yaml-或-yml文件" class="headerlink" title="基本语法创建一个 .yaml 或 .yml文件"></a>基本语法创建一个 .yaml 或 .yml文件</h5><p>​      例如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- -</span><br><span class="line">- hosts: 192.168.100.210</span><br><span class="line">remote_user: root </span><br><span class="line">tasks:</span><br><span class="line">- name:</span><br><span class="line">&quot;制作yum源”</span><br><span class="line">yum_repository: name=local description=local baseurl=file:///mnt enabled=1 gpgcheck=0 file=dgf</span><br><span class="line">- name ：&quot;挂载镜像&quot;</span><br><span class="line">mount: src=/dev/cdrom path=/mnt state=mounted</span><br><span class="line">name：&quot;安装web服务&quot;</span><br><span class="line">yum: name=httpd state=installed</span><br></pre></td></tr></table></figure>

<p>也可以在tasks中定义要执行该任务的用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  -name: 运行 df -h</span><br><span class="line">  remote_user: 用户</span><br><span class="line">  shell: name=df -h</span><br></pre></td></tr></table></figure>

<p>还可以使用sudo授权用户执行该任务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">  - name: 运行 df -h</span><br><span class="line">  sudo_user: 用户</span><br><span class="line">  sudo: ves</span><br><span class="line">  shell: name=df -h</span><br></pre></td></tr></table></figure>



<h5 id="template-引用变量"><a href="#template-引用变量" class="headerlink" title="template 引用变量"></a>template 引用变量</h5><p>首先获取10.211的http配置文件，然后改名修改配置文件，将监听端口修改为 http_port变量即可调用变量</p>
<p>例如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: 192.168.100.211</span><br><span class="line">remote_user: root</span><br><span class="line">vars:</span><br><span class="line">http_port: 8080</span><br><span class="line">tasks:</span><br><span class="line">- name ：&quot;拷贝httpd配置文件&quot;</span><br><span class="line">template:</span><br><span class="line">sre=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf</span><br><span class="line">- name ：&quot; 重启web服务&quot;</span><br><span class="line">systemd: name=httpd state=restarted</span><br></pre></td></tr></table></figure>



<h5 id="Play-book-的运行方式"><a href="#Play-book-的运行方式" class="headerlink" title="Play-book 的运行方式"></a>Play-book 的运行方式</h5><p>​     通过ansible-playbook命令运行</p>
<p>​            格式： ansible-playbook 文件    选项</p>
<p>​    常用选项：</p>
<p>​            –C     用作测试，不真正执行操作,流程是</p>
<p>​           –list-hosts  列出运行任务的主机</p>
<p>​          –list-tags     列出playbook文件中定义所有的tags</p>
<p>​            –list_tasks     列出playbook文件中定义的所有任务集</p>
<p>​            –limit   主机列表，只针对主机列表中某个主机或者某个组执行</p>
<p>​             -f       指定并发数，默认为5个</p>
<p>​             -t          指定tags运行，运行某一个或多个tags</p>
<p>​             -v      显示过程    -vv  -vvv 更详细</p>
<p><strong>Play-book 中变量的使用</strong></p>
<p>tail -10 &#x2F;etc&#x2F;ansible&#x2F;hosts</p>
<p>环境说明：配置两个组，一个testA 和一个testB组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[testA]</span><br><span class="line">192.168.100.208</span><br><span class="line">[testB]</span><br><span class="line">192.168.100.209</span><br><span class="line">[test:children]     包含testA 和testB</span><br><span class="line">testA testr</span><br></pre></td></tr></table></figure>

<p>命令行指定变量</p>
<p>ansible-playbook -e “pkg-httpd“ 1111. yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: all remote_user: root</span><br><span class="line">tasks:</span><br><span class="line">- name: install pkg yum: name=&#123;&#123; pkg &#125;&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Handlers动作-与-Notify-触发"><a href="#Handlers动作-与-Notify-触发" class="headerlink" title="Handlers动作 与 Notify 触发"></a>Handlers动作 与 Notify 触发</h2><hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- hosts: 192.168.100.210</span><br><span class="line">remote_user: root</span><br><span class="line">vars:</span><br><span class="line">http_port: 8080</span><br><span class="line">tasks:</span><br><span class="line">- name: &quot;拷贝httpd配置文件&quot;</span><br><span class="line">template: sre=httpd.conf.j2 dest=/etc/httpd/conf/httpd.conf</span><br><span class="line">notify: </span><br><span class="line">    - restart httpd</span><br><span class="line">-name：&quot;启动web服务&quot;</span><br><span class="line">systemd: name=httpd state=started</span><br><span class="line">handlers:</span><br><span class="line">   - name: restart httpd </span><br><span class="line">   system: name=httpad state=restarted</span><br></pre></td></tr></table></figure>

    </div>
    
</div>
                         
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 20xx - 2022 欢迎浏览
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @Eva
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        

    </body>
</html>